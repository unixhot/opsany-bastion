(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6a65e99e"],{"0982":function(t,e,n){"use strict";var i=n("d115"),o=n.n(i);o.a},"0c00":function(t,e,n){"use strict";e["a"]=[{width:800,height:600,key:1},{width:1024,height:768,key:2},{width:1280,height:720,key:3},{width:1280,height:800,key:4},{width:1280,height:1024,key:5},{width:1366,height:768,key:6},{width:1440,height:900,key:7},{width:1920,height:1080,key:8},{width:1920,height:1200,key:9},{width:2160,height:1440,key:10},{width:2560,height:1600,key:11},{width:2880,height:1800,key:12}]},"178e":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAA8CAYAAABSD1tKAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUFJREFUeNrslE9qg0AUxnUyIAYChcGCXWXlLqteoNfoBTyAdN92XzyAF+g1coFcINtCXMiAMBDxz2hfgkpjxvhmkU3xwcPN95t53ydvjDAMH6AXBrII9CO0h4VI+11CbwBaYoFTLdqbGBbooDVAT1igKxegtcoXuXE7U4VBJjxehUEQSV6EQZD/qw8DC/Rh6ALGDMzA3YA4jv00TT0UcBKWZekLIT7yPF9NAlLKs6hpGo9z7mt5qKrqNUmSFy3TWZa9D0ebSmkFt3xpxVrX9bMWQAjZ6QDCcZw3NGDb9qdlWQIFUEq/4fQtKlbTNPeMsUh50MVzzdiuKIoIRtkOR1EC57fQdaN5RWfgXwAxRQol9E8QBJwixXsQH5ULNKhjK5ajG/eneDuGvLminTkQHjA73ZsbfX7GzE0BV+bG6leAAQAkrHXifALBpwAAAABJRU5ErkJggg=="},"36c1":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAA8CAYAAABSD1tKAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATtJREFUeNrsllFqg0AQht1m9KEgCMEiQiFQ8AK5QK+Ra5gL9AL1AL1ArtFT9EEIFAIiBUEQIojRzjwItjg685A3F5ZZ1v9zd/5ZZS1L0ZIk8UAhfsLwDELxDsOWxrAg3GCIsD8OczAjJtELdmc8D1xyGGgbm//PgEuOWxm45GaBqeRYgEtuboVoKjmuPWjEA2CtwArcG8jz/FCWZSQCSNw0zbGu69dFgN5KYvGWqqp6E+eQZdmx7/tIBBRFsW/b9iB2Cfe9V9kKAKkK8H3/E6GTqnBhGL4bY1JVpV3XJVsrGnddt1xpz/NSx3E+Fn/G4xYEwQmPh2XbdioCBmj9RFfgnsBNC9DxbcRAHMdXjF/YrxLAaG8zf5LG1b4xXFQuIfSD4cyZMWkrQiVnBlsHzgyjvbeKKj0241eAAQCNVmmWrEMNPAAAAABJRU5ErkJggg=="},4989:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAA8CAYAAABSD1tKAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUBJREFUeNrslkGKgzAUhnUMKsWAUBFaKHQ1F5gLzAF6gbmGPcD0AB2v0QOMN5ldV121C80qorgI9qU4wxCMeVl0ZyAE5H3vvf9/GOI4lsvFBuZ57sGxIRbBr7AXBBG8GIIl5BBD8FK28Rs8CUDwGo6V+p3oxMFejiUiOnG6ykQnbhIYE6cFhsxb7ABfMFlVwJmBGXgGUJblu9xooOu6j7Ztj4yxN6uWmqY5AEzRQN/3q6qq9laihRA7VY/RJdDzWdf12sZWyjnf2QCcUlqggTAM8yiKrijA87wiTdNvlGjXdW9JknyhbYW+90EQcOPt7ft+AdlPcRyfjbe3XGrP8y86A88EhBWQZVkD5wULPloCiMFxxkB/GoZKP/KWRIsGSAyVmPWrUvci09oK1a5jZkzOYcwM4+BUM1CT/m/GXYABAE13bt7QUslYAAAAAElFTkSuQmCC"},"59c4":function(t,e,n){},"5e686":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"container_box"},[i("div",{staticClass:"container_box_left",style:{width:t.leftBoxWidth}},[i("a-spin",{staticStyle:{height:"100%",width:"100%","margin-top":"120%"},attrs:{spinning:t.treeLoading}}),t.treeList.length?i("a-tree",{staticClass:"container_box_left_tree",attrs:{"default-expand-all":"",treeData:t.treeList,replaceFields:t.replaceFields},scopedSlots:t._u([{key:"title",fn:function(e){return[i("a-dropdown",{attrs:{trigger:["contextmenu","click"]},scopedSlots:t._u(["host"==e.type?{key:"overlay",fn:function(){return[i("a-menu",{staticStyle:{width:"100px","text-align":"center"},on:{click:function(n){var i=n.key;return t.onContextMenuClick(e,i)}}},[i("a-menu-item",{key:"1"},[t._v("打开"+t._s("Windows"==e.system_type?"(新窗口)":""))])],1)]},proxy:!0}:null],null,!0)},[i("span",{staticClass:"action_title",attrs:{title:e.name+"("+e.host_address+")"}},[i("a-icon",{attrs:{type:"group"==e.type?e.expanded?"folder-open":"folder":"database"}}),t._v(" "+t._s((e.type,e.name)))],1)])]}}],null,!1,138024176)}):t._e()],1),i("div",{staticClass:"container_box_center",style:{width:"calc(100% - "+t.leftBoxWidth+" - "+t.rightBoxWidth+")"}},[i("a-tabs",{attrs:{type:"editable-card",hideAdd:""},on:{edit:t.deleteCard,change:t.changeTabs},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},t._l(t.tabList,(function(e){return i("a-tab-pane",{key:e.index,attrs:{closable:e.closable,forceRender:""},scopedSlots:t._u([{key:"tab",fn:function(){return[i("a-dropdown",{attrs:{trigger:["contextmenu"]},scopedSlots:t._u(["Linux"==e.system_type?{key:"overlay",fn:function(){return[i("a-menu",{staticStyle:{width:"80px","text-align":"center"},on:{click:function(n){var i=n.key;return t.copySession(e,i)}}},[i("a-menu-item",{key:"1"},[t._v("复制会话")])],1)]},proxy:!0}:null],null,!0)},[i("span",{attrs:{title:e.name+"("+e.host_address+")"}},[t._v(" "+t._s(e.name))])])]},proxy:!0}],null,!0)})})),1),i("div",{staticClass:"container_box_center_content"},t._l(t.tabList,(function(e){return i("div",{key:e.index,style:{height:e.index==t.activeKey?"100%":"0px"}},[i("Linux",{directives:[{name:"show",rawName:"v-show",value:e.index==t.activeKey&&"Linux"==e.system_type,expression:"item.index == activeKey && item.system_type == 'Linux'"}],ref:e.index+"_Linux",refInFor:!0,attrs:{hostParams:e}})],1)})),0),i("div",{staticClass:"container_box_center_bottom"},[i("div",{on:{click:function(e){return t.$refs.ControlFontSize.show()}}},[i("a-icon",{attrs:{type:"font-size"}}),t._v(" 字体大小")],1),i("div",{on:{click:t.handleScreenFull}},[i("a-icon",{attrs:{type:"fullscreen"}}),t._v(" 全屏")],1)]),i("div",{staticClass:"container_box_center_leftdot",on:{click:t.clickLeftDot}},[i("img",{attrs:{src:t.showRight?n("eff4"):n("178e")}})]),i("div",{staticClass:"container_box_center_rightdot",on:{click:t.clickRightDot}},[i("img",{attrs:{src:t.showRight?n("4989"):n("36c1")}})])],1),i("div",{staticClass:"container_box_right",style:{width:t.rightBoxWidth}},[i("FileSend",{ref:"FileSend"})],1),i("LoginHostModal",{ref:"LoginHostModal",on:{getHostToken:t.getHostToken}}),i("ControlFontSize",{ref:"ControlFontSize",on:{setFontSize:t.setFontSize}})],1)])},o=[],a=(n("99af"),n("7db0"),n("c740"),n("a434"),n("d3b7"),n("ac1f"),n("5319"),n("5530")),s=n("b775"),r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s["b"])({url:"host-group-console/",method:"get",params:t})},c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content",staticStyle:{height:"100%",overflow:"hidden"},attrs:{type:"flex"}},[n("div",{staticClass:"content-left",style:{width:"100%"}},[n("div",{staticClass:"custom_trem",staticStyle:{height:"100%"},attrs:{id:t.tremId}}),n("uploadModal",{ref:"uploadModal",on:{done:t.getUploadFileList}}),n("ControlFontSize",{ref:"ControlFontSize",on:{setFontSize:t.setFontSize}})],1)])},l=[],d=(n("c975"),n("ace4"),n("b0c0"),n("b64b"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("53ca")),h=(n("96cf"),n("1da1")),f=n("fcf3"),u=n("47d0"),g=(n("abb2"),n("7c1c"),n("b123")),p=n.n(g),m=n("971f"),A=n("93bf"),b=n.n(A),v=n("f12c"),y=n("4cc6"),k=n("ca00"),w=n("e6c6");p.a.Browser.send_files=m["a"];var _,x={components:{uploadModal:v["a"],ControlFontSize:y["a"]},props:{hostParams:{type:Object,default:function(){return{}}}},watch:{hostParams:{handler:function(t){Object.keys(t).length&&(this.host_token=t.host_token,this.fontSize=t.fontSize,this.tremId="term_"+t.index,this.getAgentInfo())},deep:!0,immediate:!0}},data:function(){return{tremId:"",term:{},socket:null,fitAddon:null,zsentry:null,host_token:void 0,timer:null,nodeInfo:{},xtemLoading:!1,fileLoading:!1,url:"",showRight:!0,fontSize:14}},methods:{getAgentInfo:function(){var t=this;this.$nextTick((function(){var e=document.getElementById(t.tremId),n=parseInt(e.clientHeight/17),i=parseInt((e.clientWidth-20)/9),o="http:"==window.location.protocol?"ws":"wss",a=!1,s={token:t.host_token,width:i,height:n};t.url=a?"wss://dev.opsany.cn/ws/bastion/terminalchannel/".concat(Object(k["b"])(s)):"".concat(o,"://").concat(window.location.host,"/ws/bastion/terminalchannel/").concat(Object(k["b"])(s)),t.xtemLoading=!0,Object(w["a"])({token:t.host_token,data_type:"host"}).then((function(e){t.nodeInfo=e.data})).finally((function(){t.xtemLoading=!1,t.initSocket()}))}))},initXterm:function(){var t=this,e=new f["Terminal"]({rendererType:"canvas",rows:30,convertEol:!0,scrollback:15e4,disableStdin:!1,cursorStyle:"underline",cursorBlink:!0,theme:{background:"#060101"},fontSize:this.fontSize});this.term=e,this.$nextTick((function(){var e=document.getElementById(t.tremId);if(e){t.term.open(e);var n=parseInt(e.clientHeight/17),i=parseInt((e.clientWidth-20)/9);t.fitAddon=new u["FitAddon"],t.initZmodem(),t.term.loadAddon(t.fitAddon),t.term.onData((function(e){t.socket.onsend(JSON.stringify(e))})),t.send(JSON.stringify(["set_size",n,i,i,n])),t.$nextTick((function(){t.fitAddon.fit()})),t.term.onResize((function(e){var n=e.rows,i=e.cols;t.send(JSON.stringify(["set_size",n,i,i,n]))}))}}))},initZmodem:function(){var t=this;this.zsentry&&(this.zsentry=null),this.zsentry=new p.a.Sentry({to_terminal:function(t){},on_retract:function(t){},sender:function(e){t.send(new Uint8Array(e))},on_detect:function(e){var n=e.confirm();"receive"===n.type?t.downloadFile(n):t.uploadFile(n)}})},initSocket:function(){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.socket=new WebSocket(t.url),t.socket.onopen=t.open,t.socket.onerror=t.error,t.socket.onmessage=t.getMessage,t.socket.onsend=t.send,t.socket.onclose=t.close,t.socket.binaryType="arraybuffer";case 7:case"end":return e.stop()}}),e)})))()},updateProgress:function(t){var e,n,i=t.get_details(),o=i.name,a=i.size;n=0===a?100:Math.round(t._file_offset/a*100),null===(e=this.term)||void 0===e||e.write("\r"+o+": "+a+" "+t._file_offset+" "+n+"%    ")},getUploadFileList:function(t,e){var n=this;p.a.Browser.send_files(t,e,{on_offer_response:function(t,e){var i;!e&&(null===(i=n.term)||void 0===i||i.write(t.name+" was upload skipped\r\n"))},on_progress:function(t,e){n.updateProgress(e)},on_file_complete:function(t){var e;null===(e=n.term)||void 0===e||e.write("\r\n")}}).then((function(e){t._last_header_name="ZRINIT",t.close()})).catch((function(t){}))},saveFile:function(t,e){return p.a.Browser.save_to_disk(t,e.get_details().name)},uploadFile:function(t){this.$refs.uploadModal.show(t)},downloadFile:function(t){var e=this;t.on("offer",(function(t){var n=[];t.on("input",(function(i){e.updateProgress(t),n.push(new Uint8Array(i))})),t.accept().then((function(){var i;e.saveFile(n,t),null===(i=e.term)||void 0===i||i.write("\r\n"),e.send(JSON.stringify('echo -en "OO"')),setTimeout((function(){e.initZmodem()}),1e3)}))})),t.on("session_end",(function(t){})),t.start()},setFontSize:function(t){this.term.setOption("fontSize",t),this.resizeTerm()},handleScreenFull:function(){var t=document.getElementById(this.tremId);this.$nextTick((function(){b.a.toggle(t)}))},open:function(){this.closed=!1,this.initXterm()},error:function(){},getMessage:function(t){var e=this.$createElement;if("object"==Object(d["a"])(t.data))this.zsentry.consume(t.data);else{var n,i=[{key:1,errorMsg:"参数错误，请退出后重新连接。"},{key:2,errorMsg:"用户认证失败，请退出后重新连接。"},{key:3,errorMsg:"权限认证未通过，请联系管理员后重试。"},{key:4,errorMsg:"主机资源类型错误，请联系管理员。"},{key:5,errorMsg:"连接超时，请退出后重新连接。"},{key:6,errorMsg:"凭证验证失败，请联系管理员。"},{key:7,errorMsg:"创建连接失败，请退出后重新连接。"},{key:8,errorMsg:"目前不支持该类型数据库。"},{key:9,errorMsg:"无法连接到代理服务器。"}];if(t.data.indexOf("ws_errcode")>-1){var o,a=t.data.replace(/ws_errcode:/,""),s=i.find((function(t){return t.key==a}))||{},r=s.errorMsg||"连接失败,请联系管理员后重试";return null===(o=this.term)||void 0===o||o.write(r),this.$notification.open({message:"提示",description:" IP『 ".concat(this.nodeInfo.host_address," 』").concat(r),icon:e("a-icon",{attrs:{type:"frown"},style:"color: #FF4D4F"})})}null===(n=this.term)||void 0===n||n.write(t.data)}},send:function(t){var e;null===(e=this.socket)||void 0===e||e.send(t)},close:function(t){this.closed=!0},closeRemote:function(){window.close()},resizeTerm:function(){var t=this,e=document.getElementById(this.tremId);this.$nextTick((function(){!t.closed&&e&&t.fitAddon.fit()}))},debounce:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return this.timer=null,function(){e.timer&&clearTimeout(e.timer),e.timer=setTimeout(t,n)}}},mounted:function(){},beforeDestroy:function(){this.socket.onsend(JSON.stringify(["close"])),this.socket.close()},beforeRouteLeave:function(){this.socket.onsend(JSON.stringify(["close"])),this.socket.close()},computed:{}},C=x,L=(n("ed44"),n("2877")),S=Object(L["a"])(C,c,l,!1,null,"82c7d24a",null),F=S.exports,B=n("ce17"),D=new Uint8Array(16);function R(){if(!_&&(_="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!_))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _(D)}var I=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function z(t){return"string"===typeof t&&I.test(t)}for(var T=z,E=[],H=0;H<256;++H)E.push((H+256).toString(16).substr(1));function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(E[t[e+0]]+E[t[e+1]]+E[t[e+2]]+E[t[e+3]]+"-"+E[t[e+4]]+E[t[e+5]]+"-"+E[t[e+6]]+E[t[e+7]]+"-"+E[t[e+8]]+E[t[e+9]]+"-"+E[t[e+10]]+E[t[e+11]]+E[t[e+12]]+E[t[e+13]]+E[t[e+14]]+E[t[e+15]]).toLowerCase();if(!T(n))throw TypeError("Stringified UUID is invalid");return n}var G=O;function Q(t,e,n){t=t||{};var i=t.random||(t.rng||R)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){n=n||0;for(var o=0;o<16;++o)e[n+o]=i[o];return e}return G(i)}var K=Q,M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"content-right",staticStyle:{height:"100%"}},[n("div",{staticClass:"rightbox"},[n("a-tabs",{on:{change:t.changeTabs},model:{value:t.tabs_key,callback:function(e){t.tabs_key=e},expression:"tabs_key"}},[n("a-tab-pane",{key:"1",staticClass:"session_info",attrs:{tab:"会话详情"}},[n("a-spin",{attrs:{spinning:t.xtemLoading}},[n("div",{staticStyle:{height:"100%"}},[n("div",[n("div",{staticClass:"term_info_box"},[n("div",{staticClass:"term_title"},[t._v("主机信息")]),n("div",{staticClass:"term_info"},[t._v("主机名称："+t._s(t.nodeInfo.host_name||"-"))]),n("div",{staticClass:"term_info"},[t._v("IP地址："+t._s(t.nodeInfo.host_address||"-"))])])])])])],1),n("a-tab-pane",{key:"2",staticClass:"file_trans",attrs:{tab:"文件传输",disabled:!t.file_manager}},[n("a-spin",{attrs:{spinning:t.fileLoading}},[n("div",{staticStyle:{height:"100%",overflow:"hidden"}},[n("div",{staticClass:"top_btns"},t._l(t.btnList,(function(e){return n("a-tooltip",{key:e.key,attrs:{placement:"top"}},[n("template",{slot:"title"},[n("span",[t._v(t._s(e.disabled?e.disabledHelp:e.text))])]),"upload"!=e.icon?n("a-button",{attrs:{icon:e.icon,type:"link",disabled:e.disabled},on:{click:function(n){return t.clickBtnChild(e)}}}):n("a-upload",{attrs:{name:"file",multiple:!1,showUploadList:!1,withCredentials:!0,customRequest:t.handleUpload,disabled:t.uploadLoading}},[n("a-button",{attrs:{icon:e.icon,type:"link",disabled:e.disabled},on:{click:function(n){return t.clickBtnChild(e)}}})],1)],2)})),1),n("div",{staticClass:"bread_box"},[n("a-breadcrumb",{staticClass:"breadcrumb_box"},t._l(t.breadCrumbList,(function(e,i){return n("a-breadcrumb-item",{key:i,staticClass:"breadcrumb",style:t.breadcrumbStyle,attrs:{title:e.name},nativeOn:{click:function(n){return t.clickBread(e,i)}}},[t._v(" "+t._s(e.name)+" ")])})),1)],1),t.tableData.length?n("div",{staticClass:"file_box"},t._l(t.tableData,(function(e,i){return n("div",{key:i,class:{isCheck:e.isCheck}},[n("span",{attrs:{title:e.name},on:{click:function(n){return t.clickFileName(e)}}},[n("a-icon",{staticStyle:{"padding-right":"2px"},attrs:{type:e.type}}),n("a-tooltip",{attrs:{placement:"topLeft",mouseLeaveDelay:.05}},[n("template",{slot:"title"},[n("span",[t._v(t._s(e.name))])]),n("span",[t._v(t._s(e.name))])],2)],1),n("a-tooltip",{attrs:{placement:"top"}},[n("template",{slot:"title"},[n("span",[t._v("删除")])]),n("a-icon",{staticClass:"del_icon",attrs:{type:"delete"},on:{click:function(n){return t.rightDelFile(e)}}})],2)],1)})),0):n("a-empty",{staticStyle:{"margin-top":"200px"}})],1)])],1)],1)],1)])])},U=[],W=(n("4160"),n("a15b"),n("fb6a"),n("1276"),n("159b"),n("f07a")),J={data:function(){return{host_token:void 0,nodeInfo:{},xtemLoading:!1,fileLoading:!1,tabs_key:"1",tableData:[],copy_tool:!1,file_download:!1,file_upload:!1,file_manager:!1,current_path:"",breadCrumbList:[],uploadLoading:!1}},methods:{getData:function(t){t&&(this.host_token=t),this.getHostInfo(),this.getHostAuth(),2==this.tabs_key&&this.getLinuxFileInfo()},resetData:function(){this.nodeInfo={},this.tableData=[],this.copy_tool=!1,this.file_download=!1,this.file_upload=!1,this.file_manager=!1,this.current_path="",this.breadCrumbList=[]},getHostInfo:function(){var t=this;this.xtemLoading=!0,Object(w["a"])({token:this.host_token,data_type:"host"}).then((function(e){t.nodeInfo=e.data})).finally((function(){t.xtemLoading=!1}))},getHostAuth:function(){var t=this;Object(w["a"])({token:this.host_token,data_type:"file_admin"}).then((function(e){t.copy_tool=e.data.copy_tool,t.file_download=e.data.file_download,t.file_manager=e.data.file_manager,t.file_upload=e.data.file_upload})).finally((function(){}))},changeTabs:function(t){2==t&&this.getLinuxFileInfo()},getLinuxFileInfo:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.current_path;this.fileLoading=!0;var n={data_type:"file_list",token:this.host_token,url:e};Object(W["c"])(n).then((function(e){t.current_path=e.data.current_path,t.handleBreadCrumb();var n=[],i=[];e.data.data.file.forEach((function(t){n.push({name:t,type:"file",isCheck:!1})})),e.data.data.path.forEach((function(t){i.push({name:t,type:"folder",isCheck:!1})})),t.tableData=i.concat(n)})).finally((function(){t.fileLoading=!1}))},clickBtnChild:function(t){this[t.key]&&this[t.key]()},refresh:function(){this.getLinuxFileInfo()},rightdownLoadFile:function(){var t=this.tableData.find((function(t){return t.isCheck}));if(!t)return this.$message.warning("请选择一个文件后下载");var e=this.current_path+"/"+t.name,n={token:this.host_token,url:e,data_type:"file"};window.open(Object(W["b"])(n))},handleUpload:function(t){var e=this;this.uploadLoading=!0;var n=this.$message.loading("文件上传中...",0),i=new FormData;i.append(t.filename,t.file),i.append("token",this.host_token),i.append("url",this.current_path),Object(W["d"])(i).then((function(t){e.$message.success(t.message),e.getLinuxFileInfo()})).finally((function(){n(),e.uploadLoading=!1}))},rightDelFile:function(t){var e=this,n=this.current_path+"/"+t.name,i={token:this.host_token,url:n};this.$confirm({title:"删除确认",content:"请确认是否删除【".concat(t.name,"】").concat("file"==t.type?"文件":"folder"==t.type?"文件夹":"","?"),okType:"danger",onOk:function(){return Object(W["a"])(i).then((function(t){e.$message.success(t.message),e.getLinuxFileInfo()}))}})},handleBreadCrumb:function(){var t=this.current_path.slice(1).split("/"),e=[];t.forEach((function(n,i){var o={name:n,path:t.slice(0,i+1).join("/")};e.push(o)})),e.length>3&&e.splice(1,e.length-3,{name:"...",path:null}),this.breadCrumbList=e},clickFileName:function(t){var e=this.current_path+"/"+t.name;"folder"==t.type?this.getLinuxFileInfo(e):(this.tableData.forEach((function(t){t.isCheck=!1})),t.isCheck=!0)},clickBread:function(t,e){t.path&&e!=this.breadCrumbList.length-1&&this.getLinuxFileInfo(t.path)},uploadFile:function(t){this.$refs.uploadModal.show(t)}},mounted:function(){},computed:{btnList:function(){return[{icon:"upload",key:"upload",text:"上传",disabled:!this.file_upload,disabledHelp:"因权限策略问题，暂时无法上传文件"},{icon:"download",key:"rightdownLoadFile",text:"下载",disabledHelp:"因权限策略问题或未选中文件，暂时无法下载文件",disabled:!this.tableData.find((function(t){return t.isCheck}))||!this.file_download},{icon:"reload",key:"refresh",text:"刷新",disabled:!this.file_manager,disabledHelp:"因权限策略问题，暂时无法查看文件"}]},breadcrumbStyle:function(){var t=this.breadCrumbList.length;return{maxWidth:1==t?"100%":2==t?"50%":3==t?"33%":"28%"}}}},j=J,V=(n("0982"),Object(L["a"])(j,M,U,!1,null,"e143b2ca",null)),N=V.exports,Z={components:{Linux:F,LoginHostModal:B["a"],ControlFontSize:y["a"],FileSend:N},data:function(){return{treeList:[],replaceFields:{children:"children",title:"name",key:"key"},tabList:[],activeKey:void 0,showLeft:!0,showRight:!0,timer:null,activeHostToken:void 0,treeLoading:!1}},methods:{getHostGroupList:function(){var t=this;this.treeLoading=!0,r().then((function(e){t.treeList=e.data})).finally((function(){t.treeLoading=!1}))},deleteCard:function(t){var e=this.tabList.findIndex((function(e){return e.index==t}));if(this.tabList.splice(e,1),0==this.tabList.length)return this.activeKey=void 0,this.activeHostToken=void 0,void this.$refs.FileSend.resetData();this.activeKey=this.tabList[this.tabList.length-1].index,this.activeHostToken=this.tabList[this.tabList.length-1].host_token,this.$refs.FileSend.getData(this.activeHostToken),this.resizeLinux()},clickLeftDot:function(){this.showLeft=!this.showLeft,this.resizeLinux()},clickRightDot:function(){this.showRight=!this.showRight,this.resizeLinux()},resizeLinux:function(){if(this.activeKey){var t=this.$refs[this.activeKey+"_Linux"][0];t&&setTimeout((function(){t.resizeTerm()}),120)}},onContextMenuClick:function(t,e){if(1==e){var n=this.tabList.find((function(e){return e.key==t.key}));if(n)return this.copySession(n);this.$refs.LoginHostModal.showModal(t,!0)}},copySession:function(t,e){var n=K(),i=Object(a["a"])(Object(a["a"])({},t),{},{index:n});this.tabList.push(i),this.activeKey=n,this.activeHostToken=t.host_token,this.$refs.FileSend.getData(this.activeHostToken),this.resizeLinux()},getHostToken:function(t,e){if("Windows"!=e.system_type){this.activeHostToken=t.host_token;var n=K(),i=Object(a["a"])(Object(a["a"])(Object(a["a"])({},e),t),{},{index:n});this.tabList.push(i),this.activeKey=n,this.$refs.FileSend.getData(this.activeHostToken)}else{var o=!1,s=o?"https://dev.opsany.cn/t/bastion/#/console/webWindows?host_token=".concat(t.host_token,"&winSize=").concat(t.winSize):"".concat(window.API_ROOT.replace("/bastion",""),"bastion/#/console/webWindows?host_token=").concat(t.host_token,"&winSize=").concat(t.winSize);window.open(s)}},setFontSize:function(t){if(this.activeKey){var e=this.$refs[this.activeKey+"_Linux"][0];e&&e.setFontSize(t)}},handleScreenFull:function(){if(this.activeKey){var t=this.$refs[this.activeKey+"_Linux"][0];t&&t.handleScreenFull()}},changeTabs:function(t){var e=this.tabList.find((function(e){return e.index==t}));this.activeHostToken=e.host_token,this.$refs.FileSend.getData(this.activeHostToken),this.resizeLinux()},debounce:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return this.timer=null,function(){e.timer&&clearTimeout(e.timer),e.timer=setTimeout(t,n)}}},computed:{leftBoxWidth:function(){return this.showLeft?"230px":"0px"},rightBoxWidth:function(){return this.showRight?"320px":"0px"}},mounted:function(){var t=this;this.getHostGroupList();var e=this.debounce(this.resizeLinux,100);window.addEventListener("resize",e),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",e),t.timer&&clearTimeout(t.timer)}))}},P=Z,Y=(n("cd88"),Object(L["a"])(P,i,o,!1,null,"be3c5b92",null));e["default"]=Y.exports},"6bdf":function(t,e,n){"use strict";var i=n("a0f5"),o=n.n(i);o.a},a0f5:function(t,e,n){},cd88:function(t,e,n){"use strict";var i=n("fd7c"),o=n.n(i);o.a},ce17:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("a-modal",{attrs:{closable:!1,bodyStyle:{padding:0},width:"650px",confirmLoading:t.loading},on:{ok:t.handleOk,cancel:t.handleCancel},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[i("div",{staticClass:"header"},[i("div",{staticClass:"header_left"},[i("div",[i("img",{attrs:{src:n("f2fd"),alt:""}})])]),i("div",{staticClass:"header_right"},[i("strong",[t._v(t._s(t.hostInfo.host_name))]),i("div",[t._v("主机地址："+t._s(t.hostInfo.host_address||"-"))]),i("div",[t._v("协议类型："+t._s(t.hostInfo.protocol_type||"-"))]),i("div",[t._v("端口："+t._s(t.hostInfo.port||"-"))])])]),i("a-spin",{attrs:{spinning:t.infoLoading}},[i("div",{staticClass:"content"},[i("a-form-model",{ref:"formData",attrs:{layout:"horizontal",model:t.formData,rules:t.formDataRules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[i("a-form-model-item",{attrs:{label:"资源凭证",prop:"credential_host_id"}},[i("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择资源凭证"},on:{change:t.changeCredential},model:{value:t.formData.credential_host_id,callback:function(e){t.$set(t.formData,"credential_host_id",e)},expression:"formData.credential_host_id"}},t._l(t.credentialList,(function(e){return i("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(" "+t._s(e.login_name)+"/"+t._s(e.host_address)+"("+t._s(e.credential_name)+") ")])})),1)],1),t.isHand?i("a-form-model-item",{attrs:{label:"密码"}},[i("a-input-password",{attrs:{placeholder:"请输入密码"},model:{value:t.formData.password,callback:function(e){t.$set(t.formData,"password",e)},expression:"formData.password"}})],1):t._e(),"Windows"!=t.hostInfo.system_type?i("a-form-model-item",{attrs:{label:"字体大小"}},[i("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入字体大小",min:14,max:20,allowClear:""},model:{value:t.formData.font_size,callback:function(e){t.$set(t.formData,"font_size",e)},expression:"formData.font_size"}})],1):t._e(),"Windows"==t.hostInfo.system_type?i("a-form-model-item",{attrs:{label:"分辨率"}},[i("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择分辨率",allowClear:""},on:{change:t.changeCredential},model:{value:t.formData.winSize,callback:function(e){t.$set(t.formData,"winSize",e)},expression:"formData.winSize"}},t._l(t.screenArr,(function(e){return i("a-select-option",{key:e.key,attrs:{value:e.key}},[t._v(" "+t._s(e.width)+" * "+t._s(e.height)+" ")])})),1)],1):t._e()],1)],1)])],1)],1)},o=[],a=(n("99af"),n("7db0"),n("d3b7"),n("ac1f"),n("5319"),n("5412")),s=n("e6c6"),r=n("ca00"),c=n("0c00"),l=n("cd3f"),d=n.n(l),h={data:function(){return{visible:!1,infoLoading:!1,loading:!1,hostInfo:{},formData:{host_id:void 0,credential_host_id:void 0,password:void 0,width:void 0,height:void 0,font_size:14,winSize:8},formDataRules:{credential_host_id:[{required:!0,message:"请选择资源凭证",trigger:"change"}]},labelCol:{span:4},wrapperCol:{span:20},credentialList:[],isHand:!1,screenArr:c["a"],localOpen:!1,linkType:"host"}},methods:{showModal:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"host";this.linkType=i,this.localOpen=n,this.hostInfo=d()(t),this.formData=this.$options.data().formData,this.$nextTick((function(){var t;null===(t=e.$refs.formData)||void 0===t||t.clearValidate()})),this.isHand=!1,this.getResourceCredential(),this.visible=!0},getResourceCredential:function(){var t=this;this.infoLoading=!0;var e={host_id:this.hostInfo.id,data_type:"host"};Object(a["a"])(e).then((function(e){if(t.credentialList=e.data,e.data.length>0){t.formData.credential_host_id=e.data[0].id;var n="hand"==e.data[0].login_type;t.isHand=n}})).finally((function(){t.infoLoading=!1}))},changeCredential:function(t){var e=this.credentialList.find((function(e){return e.id==t}))||{},n="hand"==e.login_type;n!=this.isHand&&(this.formData.password=void 0),this.isHand=n},handleOk:function(){var t=this;this.$refs.formData.validate((function(e){e&&(t.loading=!0,t.formData.host_id=t.hostInfo.id,Object(s["b"])(t.formData).then((function(e){window.API_ROOT.replace("/bastion/","");var n=!1,i="Windows"==t.hostInfo.system_type?"webWindows":"remoteLinux",o={host_token:e.data,fontSize:t.formData.font_size,linkType:t.linkType};if("webWindows"==i&&(delete o.fontSize,t.formData.winSize&&(o.winSize=t.formData.winSize)),t.localOpen)return t.visible=!1,t.$emit("getHostToken",o,t.hostInfo);var a=n?"".concat(window.location.origin,"/#/console/").concat(i).concat(Object(r["b"])(o)):"".concat(window.location.origin).concat(window.location.pathname,"#/console/").concat(i).concat(Object(r["b"])(o));window.open(a),t.visible=!1})).finally((function(){t.loading=!1})))}))},handleCancel:function(){this.visible=!1}},mounted:function(){}},f=h,u=(n("6bdf"),n("2877")),g=Object(u["a"])(f,i,o,!1,null,"14dcb65f",null);e["a"]=g.exports},d115:function(t,e,n){},ed44:function(t,e,n){"use strict";var i=n("59c4"),o=n.n(i);o.a},eff4:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAA8CAYAAABSD1tKAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATxJREFUeNrsk0+KgzAUxjWNCgVBCIKdVWHA3ax6gV6j17AXmBN4gF6g1+g5sh1w3ASEQAVRnPeKLfRPyMusuvDBWwS/X/K+L8YryzLxHIpBfwL04QJgrQBaQy+oAJaAzm0Qe1gvob8AWlIBrMV0kqACV2j9Kgxm8fgUBiMkeRcGI8Z/C4M5XPIlDBfgArkC3gzMwH+Auq53TdPkJADFXdft27bdWgHcFcXkkbTW32QPVVXtx3HMSYBSatP3/Y6cEsy9cYqVcy6dgDRNTwAdnS5OCHHwfV+SgSiKdBzHGKvGNSQWW+8hSRIZhuFhAlZ3Pk1HZ1l2hN/DC4JAkoArND/RGXgXYHABBmjJieIziouiGCiAgv5BsfUBQf2CsKK8uGHaVT1+4CZzID6/2ombzJlm5CZzNuDJnKn+BBgANYl2EFUH4OsAAAAASUVORK5CYII="},f2fd:function(t,e){t.exports="data:image/png;base64,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"},fd7c:function(t,e,n){}}]);